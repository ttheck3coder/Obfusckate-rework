##DREAD LOGIC IN PORTRAITS - Little icon in portraits 
gui_show_dread_icon_on_portraits_for_player = {
	saved_scopes = {
		character
	}
	is_valid = {
	exists = scope:character
	exists = root
	root ?= {is_incapable = no
		age >= 6}
	

	NOT = {scope:character ?= root}
	scope:character ?= {
		ai_boldness <= 75
			is_alive = yes
			age >= 6
			is_incapable = no
		OR = {
		AND = { #### fellow vassals not very bold
				obf_is_fellow_vassal_or_liege_councillor = yes
				ai_boldness < 50}
		
		AND = { #### Barely known terrified characters
			ai_boldness < 0
			OR = {has_character_flag = emissary_sent
			has_character_flag = partially_spied_2}
			OR = {has_dread_level_towards = {
					target = root
					level = 2	
								}
				ai_rationality <= -50 
				ai_boldness <= -40	
							}
						}
	
		AND = { #### Known characters 
		ai_boldness < 75
		OR = {
		has_character_flag = has_been_spied
		obf_has_high_level_knowledge_flags = yes

	
					}
				}
			}
		}
	}
}	

#Show dread_icon_for_liege or host(under liege's portrait)
#Will only be shown after spying or for characters with not very high boldness

gui_show_dread_icon_for_liege_or_host = {
	saved_scopes = {
		character
	}
	is_valid = {
		
	# exists = scope:character
	exists = root
		root ?= {
			is_incapable = no
			age >= 6
			probably_unintelligent_trigger = no
		}
		scope:character ?= { ### Filter adult, capable not bold characters
			is_independent_ruler = no
			ai_boldness <= 75
			is_alive = yes
			age >= 6
			is_incapable = no
			NOT = {
				OR = {
					is_vassal_of = root
					is_tributary_of = root ## added by ljl
				}
			}
		}
		OR = {
			scope:character ?= {
				obf_is_fellow_vassal_or_liege_councillor = yes
				ai_boldness < 50
			}
			scope:character ?= {
				OR = {	
					has_character_flag = had_high_level_report
					has_character_flag = has_been_spied
					AND = {   #### coward flagged	
						obf_has_high_level_knowledge_flags = yes
						ai_boldness < 25
					}
					AND = {
						ai_boldness < 0
						OR = {
							has_character_flag = emissary_sent
							has_character_flag = partially_spied_2
						}
						OR = {
							AND = {
								exists = scope:character.liege
								exists = root.liege
								has_dread_level_towards = {
									target = scope:character.liege
									level = 2	
								}
							}
							ai_rationality <= -50 
							ai_boldness <= -40	
						}
					}
				}
			}
		}
	}
}
	
#Show opinion about Liege

gui_show_opinion_about_liege = {
saved_scopes = {
character
}
	is_valid = {
	
	exists = scope:character
	exists = root
	root ?= {is_incapable = no
		age >= 12
		probably_unintelligent_trigger = no}
	NOR = {
	has_game_rule = opinions_disabled
	root ?= scope:character.liege
	scope:character ?= root}
	scope:character ?= { ### filter not talkative chars
				obf_will_hardly_talk_char_info_trigger = no
					is_alive = yes
					age >= 6
					is_incapable = no}
	OR = { scope:character ?= {has_character_flag = had_high_level_report}				
	scope:character ?= {
	obf_has_rival_or_negative_relation = no
	OR = {	has_character_flag = has_been_spied
			obf_is_fellow_vassal_or_liege_councillor = yes
			obf_works_in_same_court = yes
			obf_has_high_level_knowledge_flags = yes
			obf_has_near_intimate_or_close_relation = yes
			
			AND = {
			OR = {obf_will_openly_talk_char_info_trigger = yes
			root ?= {probably_intelligent_trigger = yes}}
			OR = {has_character_flag = emissary_sent    
			has_character_flag = partially_spied_2 }
						}
					}
				}
		}
	}
}

gui_show_opinion_about_suzerain = {
saved_scopes = {
character
}
	is_valid = {
	
	exists = scope:character
	exists = root
	root ?= {is_incapable = no
		age >= 12
		probably_unintelligent_trigger = no}
	NOR = {
	has_game_rule = opinions_disabled
	root ?= scope:character.suzerain
	scope:character ?= root}
	scope:character ?= { ### filter not talkative chars
				obf_will_hardly_talk_char_info_trigger = no
					is_alive = yes
					age >= 6
					is_incapable = no}
	OR = { scope:character ?= {has_character_flag = had_high_level_report}				
	scope:character ?= {
	obf_has_rival_or_negative_relation = no
	OR = {	has_character_flag = has_been_spied
			## obf_is_fellow_vassal_or_suzerain_councillor = yes ## need changed
			obf_works_in_same_court = yes
			obf_has_high_level_knowledge_flags = yes
			obf_has_near_intimate_or_close_relation = yes
			
			AND = {
			OR = {obf_will_openly_talk_char_info_trigger = yes
			root ?= {probably_intelligent_trigger = yes}}
			OR = {has_character_flag = emissary_sent    
			has_character_flag = partially_spied_2 }
						}
					}
				}
		}
	}
}

#### INTERFACE TRIGGERS TO SHOW DATA
#Show memories of related people
gui_show_memories = {
saved_scopes = {
character
}
	is_valid = {
	
	exists = scope:character
	exists = root
	scope:character ?= {
			OR = {
			is_consort_of = root
			is_close_family_of = root
			has_relation_lover = root
			has_relation_friend = root
			}
		}

	}
}



#Show known languages

gui_show_known_languages = {
saved_scopes = {
character
}
	is_valid = {
	exists = scope:character
	exists = root	
	root ?= {is_incapable = no
		age >= 12}
	

	scope:character ?= {
			is_alive = yes
			is_incapable = no}
	
	scope:character ?= {
	OR = {
			has_character_flag = has_been_spied
			has_character_flag = had_high_level_report
			obf_is_fellow_vassal_or_liege_councillor = yes
			obf_has_important_court_position = yes
			obf_has_guardian_or_ward_relation = yes
			obf_has_close_or_intimate_relation = yes
			obf_has_near_intimate_or_close_relation	= yes
			
	AND = {has_character_flag = partially_spied_2
			ai_sociability >= 25}
	AND = {
	OR = {has_character_flag = has_been_spied
	obf_has_high_level_knowledge_flags = yes}
	ai_sociability >= -50}
			
	
					}
				}
		}
	}

#Show known Kills

gui_show_known_kill_list = {
saved_scopes = {
character
}
	is_valid = {
	
	exists = scope:character
	exists = root
	root ?= {is_incapable = no
		age >= 12}
	scope:character ?= {
	OR = {	
			prestige_level >= 4
			highest_held_title_tier >= tier_empire
		AND = { in_diplomatic_range = root
			OR = {prestige_level >= 3
			highest_held_title_tier >= tier_kingdom}}
			obf_is_fellow_vassal_or_liege_councillor = yes
			obf_has_high_level_knowledge_flags = yes
			has_character_flag = has_been_spied
			has_character_flag = had_high_level_report
			has_character_flag = had_medium_level_report
			obf_can_be_hired_as_mercenary = yes
			any_secret = {
						secret_type = secret_murder
						is_known_by = root
						
						}
			is_allied_to = root
			### confederation ?= { any_confederation_member = { this ?= root } } # added by ljl
		    ## obf_is_in_same_confederation_as_root = yes ## added by ljl
			}
			
				}
		}
	}

#Show exact Age

gui_show_exact_age = {
	saved_scopes = {
		character
	}
	is_valid = {
		OR = {
			has_game_rule = Show_age_enabled
			AND = {
				exists = scope:character
				exists = root
				root.age >= 6
				scope:character ?= {
					OR = {
						this ?= root
						has_character_flag = has_been_spied
						obf_has_close_or_intimate_relation = yes
						obf_has_near_intimate_or_close_relation = yes
						obf_has_relation_that_would_talk_about_him = yes
						has_character_flag = had_high_level_report
						has_character_flag = had_medium_level_report
						AND = {
							OR = {
								obf_is_fellow_vassal_or_liege_councillor = yes
								obf_has_vassal_or_liege_relation = yes
								obf_has_tributary_or_suzerain_relation = yes # added by ljl
								obf_has_important_court_position = yes
								obf_has_high_level_knowledge_flags = yes
							}
							revelation_score >= 10
						}
						AND = {
							OR = {
								has_character_flag = emissary_sent				
								obf_works_in_same_court = yes
							}
							revelation_score >= 15
						}
					}
				}
			}
		}
	}
}

#Show approx Age

gui_show_approx_age = {
	saved_scopes = {
		character
	}
	is_valid = {
	
		exists = scope:character
		exists = root
		scope:character ?= {
			OR = {
				prestige_level >= 4
				highest_held_title_tier >= tier_empire
				AND = { 
					in_diplomatic_range = root
					OR = {
						prestige_level >= 3
						highest_held_title_tier >= tier_kingdom
					}
				}
					has_character_flag = emissary_sent	
					obf_is_fellow_vassal_or_liege_councillor = yes
					obf_has_vassal_or_liege_relation = yes
					obf_has_important_court_position = yes
					obf_has_high_level_knowledge_flags = yes
					is_close_or_extended_family_of = root
					obf_works_in_same_court = yes
					has_character_flag = partially_spied_2
					has_character_flag = partially_spied
					has_character_flag = had_high_level_report
					has_character_flag = had_medium_level_report
					has_character_flag = had_low_level_report
					obf_can_be_hired_as_mercenary = yes
			}
		}
	}
}

#Show focus

gui_should_choose_focus = {
saved_scopes = {
character
}
	is_valid = {
	root ?= {is_incapable = no}
	
	exists = scope:character
	exists = root
	scope:character ?= {
	OR = {
		this ?= root
		AND = {is_adult = no
			OR = {
			obf_has_high_level_knowledge_flags = yes
			scope:character.house ?= root.house
					}		
				}
			}
		}
	}
}
	
#Show health

gui_show_health = {
saved_scopes = {
character
} 
	is_valid = {
	root ?= {is_incapable = no
			age >=6}
	
	exists = scope:character
	exists = root
	scope:character ?= {
	is_alive = yes
	OR = {
		this ?= root
		has_character_flag = has_been_spied
		obf_has_high_level_knowledge_flags = yes
		obf_has_relation_that_would_talk_about_him = yes
		obf_is_fellow_vassal_or_liege_councillor = yes
		obf_has_near_intimate_or_close_relation = yes
		has_character_flag = had_high_level_report
		has_character_flag = had_medium_level_report
		AND = {health < fine_health
			OR = {has_character_flag = emissary_sent
			has_character_flag = had_low_level_report
				has_character_flag = partially_spied_2}}	
			prestige_level >= 4
			highest_held_title_tier >= tier_empire
		AND = { in_diplomatic_range = root
			OR = {prestige_level >= 3
			highest_held_title_tier >= tier_kingdom}}
			
					}
				}
			}
		}


#Prowess is known

gui_prowess_known = {
saved_scopes = {
character
}
	is_valid = {
	root ?= {is_incapable = no
		age >= 12}
	
	exists = scope:character
	exists = root
	NOT = {scope:character ?= root}
	scope:character ?= {
					age >= 12
					is_incapable = no}
	
	scope:character ?= {
	OR = {
	AND = {
	 OR = {is_courtier_of = root
     is_pool_guest_of = root}
	 prowess >= very_high_skill_rating}
	
			has_character_flag = has_been_spied
			has_character_flag = had_high_level_report
			obf_has_close_or_intimate_relation = yes
			obf_has_relation_that_would_talk_about_him = yes 
		AND = {revelation_score >= 15
		OR = {
			obf_has_high_level_knowledge_flags = yes
			obf_is_fellow_vassal_or_liege_councillor = yes
			obf_has_near_intimate_or_close_relation = yes}}
			
			
			AND = {revelation_score >= 30
				root ?= {probably_unintelligent_trigger = no}
			OR = {has_character_flag = emissary_sent
			has_character_flag = had_medium_level_report
				has_character_flag = partially_spied_2}}
				
			prestige_level >= 4
			highest_held_title_tier >= tier_empire
			obf_can_be_hired_as_mercenary = yes
		AND = { in_diplomatic_range = root
			OR = {prestige_level >= 3
			highest_held_title_tier >= tier_kingdom}}
			
	
					}
				}
			}
		}
#Efficiency is known
gui_show_efficiency = {
saved_scopes = {
character
}
	is_valid = {
	root ?= {is_incapable = no
		age >= 6}
	
	exists = scope:character
	exists = root
	scope:character ?= {is_alive = yes}
	OR = {
		AND = {
			root.top_liege ?= scope:character.top_liege
			root.top_suzerain ?= scope:character.top_suzerain
			OR = {
				is_vassal_or_below_of = root.top_liege
				is_tributary_of_suzerain_or_above = root.top_suzerain
			} ## added by ljl
		}
	
	scope:character ?= {
	OR = {
		this ?= root
			prestige_level >= 4
			highest_held_title_tier >= tier_empire
		AND = { in_diplomatic_range = root
			OR = {prestige_level >= 3
			highest_held_title_tier >= tier_kingdom}}
			has_character_flag = emissary_sent
			has_character_flag = has_been_spied
	obf_has_high_level_knowledge_flags = yes
	has_character_flag = had_high_level_report
	has_character_flag = had_medium_level_report
	has_character_flag = partially_spied_2
	obf_is_ally_or_neighbor = yes
	
					}
				}
			}
		}
	}

#Personality

gui_personality_is_known = {
saved_scopes = {
character
}
	is_valid = {
	root ?= {is_incapable = no
		age >= 12}
	
	exists = scope:character
	exists = root
	NOT = {scope:character ?= root}
	scope:character ?= {
					age >= 12
					is_incapable = no}
	
	scope:character ?= {
	OR = {
	is_spouse_of_even_if_dead = root
		obf_has_close_or_intimate_relation = yes
		has_character_flag = has_been_spied
		has_character_flag = had_high_level_report
		
			AND = {revelation_score >= 22.5
			OR = {obf_is_fellow_vassal_or_liege_councillor = yes
			obf_has_guardian_or_ward_relation = yes
			obf_has_important_court_position = yes
			obf_has_near_intimate_or_close_relation	= yes
			obf_has_high_level_knowledge_flags = yes}}
			
	
	AND = {OR = {has_character_flag = emissary_sent
				has_character_flag = partially_spied_2}
				root ?= {probably_unintelligent_trigger = no}
					revelation_score > 60}
				
	AND = {
		OR = {prestige_level >= 4
			highest_held_title_tier >= tier_empire
		AND = { in_diplomatic_range = root
			OR = {prestige_level >= 3
			highest_held_title_tier >= tier_kingdom}}}
				revelation_score >= 30}
				
				}
			}
	}
}

gui_basic_personality_is_known = {
saved_scopes = {
character
}
	is_valid = {
	root ?= {is_incapable = no
		age >= 6}
	
	exists = scope:character
	exists = root
	NOT = {scope:character ?= root}
	scope:character ?= {
					age >= 6
					is_incapable = no}
	
	scope:character ?= {
	OR = {
		obf_has_close_or_intimate_relation = yes
		obf_has_near_intimate_or_close_relation	= yes
		is_extended_family_of = root
		obf_has_important_court_position = yes
		obf_is_courtier_or_guest = yes
		is_courtier_of = root
		obf_has_guardian_or_ward_relation = yes
		obf_is_fellow_vassal_or_liege_councillor = yes
		obf_has_relation_that_would_talk_about_him = yes
		obf_has_vassal_or_liege_relation = yes
		obf_has_tributary_or_suzerain_relation = yes # added by ljl
		obf_has_rival_or_negative_relation = yes
		obf_has_high_level_knowledge_flags = yes
	
	highest_held_title_tier >= tier_empire
	has_character_flag = has_been_spied
	
	AND = { in_diplomatic_range = root
			highest_held_title_tier >= tier_kingdom}
	AND = {
		OR = {
		prestige_level >= 4
		AND = { in_diplomatic_range = root
			prestige_level >= 3}
		has_character_flag = had_medium_level_report	
		has_character_flag = partially_spied_2
		has_character_flag = emissary_sent
		}
		revelation_score >= 25}}}
	}
}

gui_first_impression_is_known = {
saved_scopes = {
character
}
	is_valid = {
	
	exists = scope:character
	exists = root
	NOT = {scope:character ?= root}
		scope:character ?= {
		OR = {

		prestige_level >= 4
		AND = { in_diplomatic_range = root
			prestige_level >= 3}
		obf_is_ally_or_neighbor = yes

		### confederation ?= { any_confederation_member = { this ?= root } }
		## obf_is_in_same_confederation_as_root = yes ## added by ljl
		has_character_flag = emissary_sent
		obf_has_high_level_knowledge_flags = yes
		obf_works_in_same_court = yes
		has_relation_potential_rival = root
		has_character_flag = had_high_level_report
		has_character_flag = had_medium_level_report
		has_character_flag = partially_spied_2
		has_character_flag = partially_spied}}
	
	}
}



#sexuality 
gui_sexuality_for_males = {
saved_scopes = {
character
}
	is_valid = {
	root ?= {is_incapable = no
			is_adult = yes}
	
	exists = scope:character
	exists = root
	scope:character ?= {
	is_adult = yes
	is_female = no
	is_alive = yes
		OR = {
	this ?= root
	has_relation_best_friend = root
	has_relation_friend = root ##added by ljl
	has_character_flag = has_been_spied
	has_character_flag = had_high_level_report
	has_relation_lover = root
	has_secret_relation_lover = root ##added by ljl
	any_secret = {
		secret_type = secret_homosexual
		is_known_by = root
						}
	any_secret = {
		secret_type = secret_deviant
		is_known_by = root
				}
	AND = {
		obf_has_high_level_knowledge_flags = yes
		ai_sociability > 75  # Character is generally sociable
                ai_boldness > 75  # Character is willing to take risks or share openly
                ai_zeal > 75      # Characters with strong beliefs might also be open in discussing it
					}
				}
			}
		}
	}
	
gui_sexuality_for_females = {
saved_scopes = {
character
}
	is_valid = {
	root ?= {is_incapable = no
		is_adult = yes}
	
	exists = scope:character
	exists = root
	scope:character ?= {
	is_adult = yes
	is_female = yes
	is_alive = yes
		OR = {
	this ?= root
	has_relation_best_friend = root
	has_relation_friend = root ##added by ljl
	has_character_flag = has_been_spied
	has_character_flag = had_high_level_report
	has_relation_lover = root
	has_secret_relation_lover = root ##added by ljl
	any_secret = {
		secret_type = secret_homosexual
		is_known_by = root
						}
	any_secret = {
		secret_type = secret_deviant
		is_known_by = root
				}
	AND = {
		obf_has_high_level_knowledge_flags = yes
		ai_sociability > 75  # Character is generally sociable
                ai_boldness > 75  # Character is willing to take risks or share openly
                ai_zeal > 75      # Characters with strong beliefs might also be open in discussing it
					}
				}
			}
		}
	}

#Rumours
gui_rumours_icon_shown = {
saved_scopes = {
character
}
	is_valid = {
	root ?= {is_incapable = no
		age >= 6}
	
	exists = scope:character
	exists = root
	root ?= {is_character_interaction_shown = {
				recipient = scope:character
				interaction = has_heard_rumours_interaction
			}
		}
	}
}

#Gold
gui_wealth_shown = {
saved_scopes = {
character
}

	is_shown = {
	root ?= {is_incapable = no
		age >= 12
		NOT = {has_trait = dull}}
	
	exists = scope:character
	exists = root
	scope:character ?= {
	is_alive = yes
	OR = {
		this ?= root
		has_character_flag = has_been_spied
		obf_has_close_or_intimate_relation = yes
		obf_has_guardian_or_ward_relation = yes
			}
		}
	}

	is_valid = {
	root ?= {is_incapable = no
		age >= 6}
	
	exists = scope:character
	exists = root
	NOT = {scope:character ?= root}
	scope:character ?= {
	is_alive = yes}
	OR = {
	root ?= {
	OR = {is_diarch_of_target = scope:character
	AND = {exists = scope:character.liege
	is_diarch_of_target = scope:character.liege}}}
	
		AND = {		exists = scope:character.liege
					exists = root.liege
					exists = scope:character.liege.cp:councillor_steward		
					root.liege ?= scope:character.liege
					scope:character.liege.cp:councillor_steward = root}
	
	scope:character ?= {
	OR = {
	has_character_flag = emissary_sent
	obf_has_high_level_knowledge_flags = yes
	obf_has_relation_that_would_talk_about_him = yes
	obf_has_close_or_intimate_relation = yes
	is_close_or_extended_family_of = root
	obf_has_important_court_position = yes
	obf_is_courtier_or_guest = yes
	is_courtier_of = root
	obf_has_guardian_or_ward_relation = yes
	obf_has_near_intimate_or_close_relation = yes
	is_vassal_of = root
	is_tributary_of = root ## added by ljl
	has_character_flag = had_high_level_report
	has_character_flag = had_medium_level_report
		AND = {
			age >= 12
			revelation_score > 15
		has_character_flag = partially_spied_2
		OR = {ai_greed > 50
			has_trait = arrogant}
						}
					}
				}
			}
		}
	}
	
#prestige

gui_prestige_shown = {
saved_scopes = {
character
}
	is_valid = {
	exists = scope:character
	exists = root
	root ?= {is_incapable = no
		age >= 6}
	scope:character ?= {
	is_alive = yes
	OR = {
	this ?= root
	obf_is_fellow_vassal_or_liege_councillor = yes
	AND = {top_liege = root.top_liege
			prestige_level >= 2}
	AND = {top_liege = root.top_liege
			influence_level >= 1}
	prestige_level >= 4
			highest_held_title_tier >= tier_empire
		AND = { in_diplomatic_range = root
			OR = {prestige_level >= 3
			highest_held_title_tier >= tier_kingdom}}
	has_character_flag = has_been_spied
	has_character_flag = emissary_sent
	obf_has_high_level_knowledge_flags = yes
	obf_has_close_or_intimate_relation = yes
	obf_has_near_intimate_or_close_relation = yes
	obf_has_relation_that_would_talk_about_him = yes
	has_character_flag = had_high_level_report
	has_character_flag = had_medium_level_report
	has_character_flag = partially_spied_2
	obf_is_ally_or_neighbor = yes

	### confederation ?= { any_confederation_member = { this ?= root } }
	## obf_is_in_same_confederation_as_root = yes ## added by ljl
	obf_can_be_hired_as_mercenary = yes
	
					}
				}
		}
	}
#herd
gui_herd_shown = {
    saved_scopes = {
        character
    }
    is_valid = {
        # --- 前置条件：玩家和目标角色必须是有效的 ---
        exists = scope:character
	    exists = root

        root ?= {
            is_incapable = no
            age >= 6
        }

        scope:character ?= {
            is_alive = yes
        }
        # -----------------------------------------

        # --- 核心逻辑开始 ---
        OR = {
            ### 逻辑一：查看自己时，无视任何规则，永远为真
            scope:character ?= root

            ### 逻辑二：当“显示所有”规则开启时，无视其他条件，永远为真
			has_game_rule = Show_herd_enabled
            # AND = { has_game_rule = Show_herd_enabled NOT = { has_game_rule = Show_herd_disabled } }

            ### 逻辑三：当规则未开启时，进行特殊条件判断
            OR = {   ##AND = 
                # # 确认“显示所有”规则是关闭的
                # NOT = { has_game_rule = Show_herd_disabled }
				# ## has_game_rule = Show_herd_disabled
                
                # 然后检查所有特殊的“知情”理由
                scope:character ?= {
                    OR = {
                        # 注意：这里不再需要 this ?= root，因为它已经被逻辑一提走了
						is_vassal_of = root
						is_tributary_of = root
						## is_tributary_of_suzerain_or_above = $CHARACTER$  ##
						## is_tributary_of_suzerain_or_above = root
                        obf_is_fellow_vassal_or_liege_councillor = yes
                        
                        # highest_held_title_tier >= tier_empire
                        # AND = {
                        #     in_diplomatic_range = root
                        #     OR = {
                        #         prestige_level >= 3
                        #         highest_held_title_tier >= tier_kingdom
                        #     }
                        # }
						# prestige_level >= 4
                        # piety_level >= 4
                        has_character_flag = has_been_spied
                        has_character_flag = emissary_sent
                        obf_has_high_level_knowledge_flags = yes
                        obf_has_close_or_intimate_relation = yes
                        obf_has_near_intimate_or_close_relation = yes
                        obf_has_relation_that_would_talk_about_him = yes
                        has_character_flag = had_high_level_report
                        has_character_flag = had_medium_level_report
                        has_character_flag = partially_spied_2
						obf_is_ally_or_neighbor = yes
						### confederation ?= { any_confederation_member = { this ?= root } }
                      	## obf_is_in_same_confederation_as_root = yes ## added by ljl
                        obf_can_be_hired_as_mercenary = yes
                    }
                }
				## NOT = { has_game_rule = Show_herd_disabled }
            }
        }
    }
}

# gui_herd_shown = {
# saved_scopes = {
# character
# }
# 	is_valid = {
# 	root ?= {is_incapable = no
# 		age >= 6}
	# exists = scope:character
	# exists = root
# 	scope:character ?= {
# 	is_alive = yes
# 	OR = {
# 	this ?= root
# 	obf_is_fellow_vassal_or_liege_councillor = yes
# 	prestige_level >= 4
# 			highest_held_title_tier >= tier_empire
# 		AND = { in_diplomatic_range = root
# 			OR = {prestige_level >= 3
# 			highest_held_title_tier >= tier_kingdom}}
# 	piety_level >= 4 ##need changed 
# 	And = {NOT = { has_game_rule = Show_herd_disabled } has_game_rule = Show_gerd_enabled }
# 	has_character_flag = has_been_spied ## added by ljl
# 	has_character_flag = emissary_sent
# 	obf_has_high_level_knowledge_flags = yes
# 	obf_has_close_or_intimate_relation = yes
# 	obf_has_near_intimate_or_close_relation = yes
# 	obf_has_relation_that_would_talk_about_him = yes
# 	has_character_flag = had_high_level_report
# 	has_character_flag = had_medium_level_report
# 	has_character_flag = partially_spied_2
# 	obf_can_be_hired_as_mercenary = yes
	
# 					}
# 				}
# 		}
# }


#piety

gui_piety_shown = {
saved_scopes = {
character
}
	is_valid = {
	root ?= {is_incapable = no
		age >= 6}
	
	exists = scope:character
	exists = root
	scope:character ?= {
	is_alive = yes
	OR = {
	this ?= root
	obf_is_fellow_vassal_or_liege_councillor = yes
	prestige_level >= 4
			highest_held_title_tier >= tier_empire
		AND = { in_diplomatic_range = root
			OR = {prestige_level >= 3
			highest_held_title_tier >= tier_kingdom}}
	piety_level >= 4
	has_character_flag = has_been_spied
	has_character_flag = emissary_sent
	obf_has_high_level_knowledge_flags = yes
	obf_has_close_or_intimate_relation = yes
	obf_has_near_intimate_or_close_relation = yes
	obf_has_relation_that_would_talk_about_him = yes
	has_character_flag = had_high_level_report
	has_character_flag = had_medium_level_report
	has_character_flag = partially_spied_2
	obf_can_be_hired_as_mercenary = yes
	
					}
				}
		}
	}

#influence
gui_influence_shown = {
    saved_scopes = {
        character
    }
    is_valid = {
        # --- 前置条件：玩家和目标角色必须是有效的 ---
        exists = scope:character
	    exists = root
        root ?= {
            is_incapable = no
            age >= 6
        }
        scope:character ?= {
            is_alive = yes
        }
        # -----------------------------------------

        # --- 核心逻辑开始 ---
        OR = {
            ### 逻辑一：查看自己时，无视任何规则，永远为真
            scope:character ?= root

            ### 逻辑二：当“显示所有”规则开启时，无视其他条件，永远为真
            has_game_rule = Show_influence_enabled

            ### 逻辑三：当规则未开启时，进行特殊条件判断
                
                # 然后检查所有特殊的“知情”理由
                scope:character ?= {
                    OR = {
                        # 注意：这里不再需要 this ?= root，因为它已经被逻辑一提走了
                        obf_is_fellow_vassal_or_liege_councillor = yes
						is_vassal_of = root
						# is_vassal_or_below_of = root
                        
						AND = {top_liege = root.top_liege
								prestige_level >= 2}
						AND = {top_liege = root.top_liege
								influence_level >= 2}
						prestige_level >= 4
						highest_held_title_tier >= tier_empire
						AND = { in_diplomatic_range = root
							OR = {prestige_level >= 3
							highest_held_title_tier >= tier_kingdom}}
                        #### piety_level >= 4
                        has_character_flag = has_been_spied
                        has_character_flag = emissary_sent
                        obf_has_high_level_knowledge_flags = yes
                        obf_has_close_or_intimate_relation = yes
                        obf_has_near_intimate_or_close_relation = yes
                        obf_has_relation_that_would_talk_about_him = yes
                        has_character_flag = had_high_level_report
                        has_character_flag = had_medium_level_report
                        has_character_flag = partially_spied_2
						obf_is_ally_or_neighbor = yes
						### confederation ?= { any_confederation_member = { this ?= root } }
                      	## obf_is_in_same_confederation_as_root = yes ## added by ljl
                        obf_can_be_hired_as_mercenary = yes
                    }
                }
        }
    }
}
# gui_influence_shown = {
# saved_scopes = {
# character
# }
# 	is_valid = {
# 	root ?= {is_incapable = no
# 		age >= 6}
	# exists = scope:character
	# exists = root
# 	scope:character ?= {
# 	is_alive = yes
# 	OR = {
# 	this ?= root 
# 	obf_is_fellow_vassal_or_liege_councillor = yes
# 	AND = {top_liege = root.top_liege
# 			prestige_level >= 2}
# 	AND = {top_liege = root.top_liege
# 			influence_level >= 1}
# 	prestige_level >= 4
# 			highest_held_title_tier >= tier_empire
# 		AND = { in_diplomatic_range = root
# 			OR = {prestige_level >= 3
# 			highest_held_title_tier >= tier_kingdom}}
# 	And = {NOT = { has_game_rule = Show_influence_disabled } has_game_rule = Show_influence_enabled }
# 	has_character_flag = has_been_spied
# 	has_character_flag = emissary_sent
# 	obf_has_high_level_knowledge_flags = yes
# 	obf_has_close_or_intimate_relation = yes
# 	obf_has_near_intimate_or_close_relation = yes
# 	has_character_flag = had_high_level_report
# 	has_character_flag = had_medium_level_report
# 	has_character_flag = partially_spied_2
# 	obf_is_ally_or_neighbor = yes
	
# 					}
# 				}
# 			}
# 		}
#Legitimiacy 

gui_legitimacy_shown = {
saved_scopes = {
character
}
	is_valid = {
	root ?= {is_incapable = no
		age >= 6}
	
	exists = scope:character
	exists = root
	scope:character ?= {
	is_alive = yes
	OR = {
	this ?= root
	obf_is_fellow_vassal_or_liege_councillor = yes
	prestige_level >= 4
			highest_held_title_tier >= tier_empire
		AND = { in_diplomatic_range = root
			OR = {prestige_level >= 3
			highest_held_title_tier >= tier_kingdom}}
	has_character_flag = has_been_spied
	has_character_flag = emissary_sent
	obf_has_high_level_knowledge_flags = yes
	obf_has_close_or_intimate_relation = yes
	obf_has_near_intimate_or_close_relation = yes
	has_character_flag = had_high_level_report
	has_character_flag = had_medium_level_report
	has_character_flag = partially_spied_2
			top_liege = root.top_liege
			is_vassal_of = root
			is_liege_or_above_of = root
			is_tributary_of = root ## added by ljl
			scope:character.suzerain= root
			suzerain = root ## added by ljl

	obf_is_ally_or_neighbor = yes
	### confederation ?= { any_confederation_member = { this ?= root } }
	
					}
				}
			}
		}
	
#Dread

gui_dread_shown = {
saved_scopes = {
character
}
	is_valid = {
		root ?= {is_incapable = no
			age >= 6}
		
		exists = scope:character
		exists = root
		NOT = {scope:character ?= root}
		scope:character ?= {
			is_alive = yes
			OR = {
				obf_is_fellow_vassal_or_liege_councillor = yes
				prestige_level >= 4
				highest_held_title_tier >= tier_empire
				AND = { 
					in_diplomatic_range = root
					OR = {prestige_level >= 3
					highest_held_title_tier >= tier_kingdom}
				}	
				has_character_flag = has_been_spied
				has_character_flag = had_high_level_report
				obf_has_high_level_knowledge_flags = yes
				obf_has_close_or_intimate_relation = yes
				obf_has_relation_that_would_talk_about_him = yes

				is_vassal_of = root
				is_liege_or_above_of = root
				is_tributary_of = root ## added by ljl
				scope:character.suzerain= root
				#  suzerain = root ## added by ljl scope:character.suzerain= this
				AND = {
					has_character_flag = had_medium_level_report
					has_character_flag = partially_spied_2
					has_character_flag = emissary_sent
					OR = {	
						dread >= medium_dread
						ai_compassion < -50
						ai_honor < -75		
						ai_rationality < -20
					}
				}
			}
		}
	}
}
	
#army
gui_military_strength_shown = {
saved_scopes = {
character
}
	is_valid = {
	root ?= {is_incapable = no
		age >= 6}
	
	exists = scope:character
	exists = root
	OR = {
	root ?= {
	OR = {is_diarch_of_target = scope:character
	AND = {exists = scope:character.liege
	is_diarch_of_target = scope:character.liege}}}
		
		AND = {exists = scope:character.cp:councillor_marshal
		scope:character.cp:councillor_marshal = root}
		
		AND = {exists = scope:character.liege
					exists = root.liege
					exists = root.liege.cp:councillor_marshal
					scope:character.liege ?= {is_vassal_or_below_of = root.liege}
					root.liege.cp:councillor_marshal = root}
		AND = {exists = scope:character.suzerain
			exists = root.suzerain
			exists = root.suzerain.cp:councillor_marshal
			scope:character.suzerain ?= {is_tributary_of_suzerain_or_above = root.suzerain} #added by ljl? What is CP
			root.suzerain.cp:councillor_marshal = root}
					
		AND = {		exists = scope:character.liege
					exists = root.liege
					exists = scope:character.liege.cp:councillor_marshal
					root.liege ?= scope:character.liege
					scope:character.liege.cp:councillor_marshal = root}		
					
		AND = {
				exists = scope:character.top_liege
				exists = scope:character.top_liege.cp:councillor_marshal
				exists = root.top_liege
				root.top_liege ?= scope:character.top_liege
					scope:character.top_liege.cp:councillor_marshal = root}
	
	scope:character ?= {
	OR = {
	this ?= root
	obf_can_be_hired_as_mercenary = yes
	has_government = landless_adventurer_government
	has_character_flag = requested_military_info
	has_character_flag = has_been_spied
	is_vassal_or_below_of = root
	## is_tributary_of_suzerain_or_above = root ## added by ljl
	is_allied_to = root
	### confederation ?= { any_confederation_member = { this ?= root } } # added by ljl
	## obf_is_in_same_confederation_as_root = yes ## added by ljl
	
					}
				}
			}
		}
	}
	
gui_military_strength_progress_bar_shown = {
saved_scopes = {
character
}
	is_valid = {
	root ?= {is_incapable = no
		age >= 6}
	
	exists = scope:character
	exists = root
	OR = {
	root ?= {
	OR = {is_diarch_of_target = scope:character
	AND = {exists = scope:character.liege
	is_diarch_of_target = scope:character.liege}}}
	
		AND = {exists = scope:character.cp:councillor_marshal
		scope:character.cp:councillor_marshal = root}

		# AND = {exists = scope:character.suzerain
		# 	exists = root.suzerain
		# 	exists = root.suzerain.cp:councillor_marshal
		# 	scope:character.suzerain ?= {is_tributary_of_suzerain_or_above = root.suzerain} #added by ljl? What is CP
		# 	root.suzerain.cp:councillor_marshal = root}
		
		AND = {exists = scope:character.liege
					exists = root.liege
					exists = root.liege.cp:councillor_marshal
					scope:character.liege ?= {is_vassal_or_below_of = root.liege}
					root.liege.cp:councillor_marshal = root}
					
		AND = {		exists = scope:character.liege
					exists = root.liege
					exists = scope:character.liege.cp:councillor_marshal
					root.liege ?= scope:character.liege
					scope:character.liege.cp:councillor_marshal = root}		
					
		AND = {
				exists = scope:character.top_liege
				exists = scope:character.top_liege.cp:councillor_marshal
				exists = root.top_liege
				root.top_liege ?= scope:character.top_liege
					scope:character.top_liege.cp:councillor_marshal = root}
	
	scope:character ?= {
	OR = {
	this ?= root
	is_vassal_or_below_of = root
	is_tributary_of_suzerain_or_above = root ## added by ljl
	obf_is_ally_or_neighbor = yes
	### confederation ?= { any_confederation_member = { this ?= root } }
	## obf_is_in_same_confederation_as_root = yes ## added by ljl
	
					}
				}
			}
		}
	}
	
	
#Faith and Culture

gui_faith_and_culture_known = {
saved_scopes = {
character
}
	is_valid = {
	root ?= {is_incapable = no
		age >= 6}
	
	exists = scope:character
	exists = root
	scope:character ?= {
	OR = {
	this ?= root
	prestige_level >= 4
	piety_level >= 4
			highest_held_title_tier >= tier_empire
		AND = { in_diplomatic_range = root
			OR = {prestige_level >= 3
					piety_level >= 3
					legitimacy_level >= 4
			highest_held_title_tier >= tier_kingdom}}
			has_character_flag = has_been_spied
			has_character_flag = emissary_sent
	obf_has_high_level_knowledge_flags = yes
	
	is_imprisoned_by = root
	AND = {
    exists = root.liege
    this ?= root.liege
	}
	is_contact_of = root
	is_vassal_of = root
	is_tributary_of = root ## added by ljl
	obf_is_fellow_vassal_or_liege_councillor = yes
	obf_works_in_same_court	= yes
	obf_is_ally_or_neighbor = yes
	### confederation ?= { any_confederation_member = { this ?= root } }
	## obf_is_in_same_confederation_as_root = yes ## added by ljl
	obf_has_relation_that_would_talk_about_him = yes 
	has_character_flag = had_high_level_report
	has_character_flag = had_medium_level_report
	has_character_flag = had_low_level_report	
	has_character_flag = partially_spied_2
	obf_can_be_hired_as_mercenary = yes
	
	AND = {has_character_flag = partially_spied
			OR = {
			has_trait = crusader_king
			has_trait = order_member
			influence_level >= 2
			ai_zeal > 50}}
	
	
					}
				}
			}
		}

#Show modifiers

gui_show_modifiers = {
saved_scopes = {
character
}
	is_valid = {
	root ?= {is_incapable = no
		age >= 6}
	
	exists = scope:character
	exists = root
	scope:character ?= {is_alive = yes}

	
	scope:character ?= {
	OR = {
		this ?= root
			has_character_flag = emissary_sent
			has_character_flag = has_been_spied
			has_character_flag = had_high_level_report
	obf_has_close_or_intimate_relation = yes

					}
				}
			}
		}
	
#House

gui_house_known = {
	saved_scopes = {
		character
	}
	is_valid = {
		root ?= {
			is_incapable = no
			age >= 6
		}
		scope:character ?= {
			OR = {
				this ?= root
				matchmaker.highest_held_title_tier >= tier_kingdom 
				highest_held_title_tier >= tier_empire
				prestige_level >= 4
				piety_level >= 4
				dynasty.dynasty_prestige_level >= 4
				AND = {
					in_diplomatic_range = root
					OR = {
						prestige_level >= 3
						piety_level >= 3
						influence_level >= 3
						legitimacy_level >= 4
						dynasty.dynasty_prestige_level >= 3
						highest_held_title_tier >= tier_kingdom
					}
				}
				has_character_flag = has_been_spied
				has_character_flag = emissary_sent
				scope:character.house ?= root.house
				obf_is_fellow_vassal_or_liege_councillor = yes
				obf_has_high_level_knowledge_flags = yes
				obf_has_relation_that_would_talk_about_him = yes
				obf_has_close_or_intimate_relation = yes
				obf_has_near_intimate_or_close_relation = yes
				obf_is_ally_or_neighbor = yes 
				### confederation ?= { any_confederation_member = { this ?= root } }
				## obf_is_in_same_confederation_as_root = yes ## added by ljl
				has_character_flag = partially_spied_2
				has_character_flag = had_high_level_report
				has_character_flag = had_medium_level_report
				has_character_flag = had_low_level_report
				obf_can_be_hired_as_mercenary = yes
				AND = {
					has_character_flag = partially_spied
					OR = {
						influence_level >= 2
						has_trait = arrogant
					}
				}
			}
		}
	}
}

#domain

gui_show_domain = {
saved_scopes = {
character
}
	is_valid = {
	root ?= {is_incapable = no}
	
	exists = scope:character
	exists = root
	scope:character ?= {is_alive = yes}
	OR = {
		
	AND = {
		root.top_liege ?= scope:character.top_liege
		is_vassal_or_below_of = root.top_liege
	}

	AND = {
		root.top_suzerain ?= scope:character.top_suzerain
		is_tributary_of_suzerain_or_above = root.top_suzerain
	}
	
	scope:character ?= {
	OR = {
		this ?= root
			
			highest_held_title_tier >= tier_empire
		prestige_level >= 4
		piety_level >= 4
			AND = { in_diplomatic_range = root
			OR = {prestige_level >= 3
				influence_level >= 3
					legitimacy_level >= 4
			highest_held_title_tier >= tier_kingdom}}
			has_character_flag = emissary_sent
			has_character_flag = has_been_spied
			has_character_flag = had_high_level_report
	obf_has_high_level_knowledge_flags = yes
	obf_is_ally_or_neighbor = yes 
	### confederation ?= { any_confederation_member = { this ?= root } }
	## obf_is_in_same_confederation_as_root = yes ## added by ljl
	has_character_flag = had_medium_level_report

		AND = {has_character_flag = partially_spied_2
			OR = {
			influence_level >= 2
			has_trait = arrogant}}
	
					}
				}
			}
		}
	}
	
#titles and claims

gui_show_titles_and_claims = {
saved_scopes = {
character
}
	is_valid = {
	root ?= {is_incapable = no
		age >= 6}
	
	exists = scope:character
	exists = root
	scope:character ?= {
	OR = {
	this ?= root
		
			prestige_level >= 4
			highest_held_title_tier >= tier_empire
		AND = { in_diplomatic_range = root
			OR = {prestige_level >= 3
			influence_level >= 3
			legitimacy_level >= 4
			highest_held_title_tier >= tier_kingdom}}
			has_character_flag = has_been_spied
			has_character_flag = emissary_sent
		obf_has_high_level_knowledge_flags = yes
	is_imprisoned_by = root
	AND = {
    exists = root.liege
	this ?= root.liege
	}
	is_contact_of = root
	## is_vassal_of = root
	is_vassal_or_below_of = root
	is_tributary_of_suzerain_or_above = root ## added by ljl
	obf_is_fellow_vassal_or_liege_councillor = yes
	obf_works_in_same_court	= yes
	obf_is_ally_or_neighbor = yes
	### confederation ?= { any_confederation_member = { this ?= root } }
	## obf_is_in_same_confederation_as_root = yes ## added by ljl
	obf_has_relation_that_would_talk_about_him = yes  
	obf_has_close_or_intimate_relation = yes
	obf_has_near_intimate_or_close_relation = yes
	has_character_flag = had_high_level_report
	has_character_flag = had_medium_level_report
	has_character_flag = had_low_level_report
	has_character_flag = partially_spied_2
			obf_can_be_hired_as_mercenary = yes
		AND = {has_character_flag = partially_spied
			OR = {
			influence_level >= 2
			has_trait = arrogant}}
	
					}
				}
			}
		}

#diplomacy items

gui_show_diplomacy_items = {
saved_scopes = {
character
}
	is_valid = {
	root ?= {is_incapable = no
		age >= 6}
	
	exists = scope:character
	exists = root
	scope:character ?= {
	is_alive = yes
	OR = {
	this ?= root
			prestige_level >= 4
			highest_held_title_tier >= tier_empire
		AND = { in_diplomatic_range = root
			OR = {prestige_level >= 3
			influence_level >= 3
			highest_held_title_tier >= tier_kingdom}}
			has_character_flag = has_been_spied
			has_character_flag = had_high_level_report
	obf_has_high_level_knowledge_flags = yes
	is_imprisoned_by = root
	AND = {
    exists = root.liege
	this ?= root.liege
	}
	is_contact_of = root
	## is_vassal_of = root
	is_vassal_or_below_of = root
	is_tributary_of_suzerain_or_above = root ## added by ljl
	obf_is_fellow_vassal_or_liege_councillor = yes
	obf_works_in_same_court	= yes
	obf_is_ally_or_neighbor = yes
	### confederation ?= { any_confederation_member = { this ?= root } }
	## obf_is_in_same_confederation_as_root = yes ## added by ljl
	obf_has_relation_that_would_talk_about_him = yes  
	obf_has_close_or_intimate_relation = yes
	obf_can_be_hired_as_mercenary = yes
			
		AND = {
			OR = {
				has_character_flag = partially_spied_2
				has_character_flag = emissary_sent}
			OR = {
			influence_level >= 2
			obf_will_hardly_talk_char_info_trigger = no
			has_trait = arrogant}}
		
					}
				}
			}
		}

#Family,relations,courtiers,vassals tabs

gui_tab_count_known = {
saved_scopes = {
character
}
	is_valid = {
	root ?= {is_incapable = no
		age >= 6}
	
	exists = scope:character
	exists = root
	scope:character ?= {
	OR = {
	this ?= root
	has_character_flag = has_been_spied
	has_character_flag = had_high_level_report
	obf_has_high_level_knowledge_flags = yes
	obf_is_fellow_vassal_or_liege_councillor = yes
	obf_works_in_same_court	= yes
	has_character_flag = had_medium_level_report
	
	
					}
				}
			}
		}
	
gui_tab_count_estimate_known = {
saved_scopes = {
character
}
	is_valid = {
	root ?= {is_incapable = no
		age >= 6}
	
	exists = scope:character
	exists = root
	NOT = {scope:character ?= root} 
	scope:character ?= {
	OR = {
			prestige_level >= 4
			highest_held_title_tier >= tier_empire
		AND = { in_diplomatic_range = root
			OR = {prestige_level >= 3
			highest_held_title_tier >= tier_kingdom}}
	has_character_flag = partially_spied_2
	has_character_flag = emissary_sent
	has_character_flag = has_been_spied
	has_character_flag = had_high_level_report
	obf_has_relation_that_would_talk_about_him = yes
	has_character_flag = had_low_level_report
	
					}
				}
		}
	}
	
	
gui_show_family_tab = {
saved_scopes = {
character
}
	is_valid = {
	
	exists = scope:character
	exists = root
	scope:character ?= {
	OR = { 
	this ?= root
	prestige_level >= 4
			highest_held_title_tier >= tier_empire
		AND = { in_diplomatic_range = root
			OR = {prestige_level >= 3
			highest_held_title_tier >= tier_kingdom}}
			has_character_flag = has_been_spied
			has_character_flag = emissary_sent
	obf_has_high_level_knowledge_flags = yes
	obf_has_close_or_intimate_relation = yes
	obf_has_near_intimate_or_close_relation = yes
	obf_is_fellow_vassal_or_liege_councillor = yes
	obf_works_in_same_court	= yes
	obf_is_ally_or_neighbor = yes
	### confederation ?= { any_confederation_member = { this ?= root } }
	## obf_is_in_same_confederation_as_root = yes ## added by ljl

	is_close_or_extended_family_of = root
	obf_has_relation_that_would_talk_about_him = yes
	has_character_flag = had_high_level_report
	has_character_flag = had_medium_level_report
	has_character_flag = partially_spied_2
		any_close_family_member = {
		OR = {
		has_character_flag = has_been_spied
		has_character_flag = had_high_level_report
		has_character_flag = emissary_sent
	obf_has_high_level_knowledge_flags = yes
	has_character_flag = partially_spied_2
	has_character_flag = had_medium_level_report}
						}
	
					}
				}
			}
		}

gui_show_relations_tab = {
saved_scopes = {
character
}
	is_valid = {
	
	exists = scope:character
	exists = root
	scope:character ?= {
	OR = {
	this ?= root
	prestige_level >= 4
			highest_held_title_tier >= tier_empire
		AND = { in_diplomatic_range = root
			OR = {prestige_level >= 3
			highest_held_title_tier >= tier_kingdom}}
			has_character_flag = has_been_spied
	obf_has_high_level_knowledge_flags = yes
	obf_is_fellow_vassal_or_liege_councillor = yes
	obf_has_near_intimate_or_close_relation	= yes
	obf_has_close_or_intimate_relation = yes
	obf_has_relation_that_would_talk_about_him = yes
	has_character_flag = partially_spied_2
	has_character_flag = had_high_level_report
	has_character_flag = had_medium_level_report
		any_relation = {
		type = lover
		NOT = {has_secret_relation_lover = scope:character}
		is_alive = yes
		OR = {
		has_character_flag = has_been_spied
		has_character_flag = emissary_sent
	obf_has_high_level_knowledge_flags = yes
	has_character_flag = partially_spied_2
	has_character_flag = had_high_level_report
	has_character_flag = had_medium_level_report}
		}
		any_relation = {
		type = friend
		NOT = {has_secret_relation_friend = scope:character}
		is_alive = yes
		OR = {
		has_character_flag = has_been_spied
		has_character_flag = emissary_sent
	obf_has_high_level_knowledge_flags = yes
	has_character_flag = partially_spied_2
	has_character_flag = had_high_level_report
	has_character_flag = had_medium_level_report}
		}
		any_relation = {
		type = rival
		NOT = {has_secret_relation_rival = scope:character}
		is_alive = yes
		OR = {
		has_character_flag = has_been_spied
		has_character_flag = emissary_sent
	obf_has_high_level_knowledge_flags = yes
	has_character_flag = partially_spied_2
	has_character_flag = had_high_level_report
	has_character_flag = had_medium_level_report}
		}
		any_secret = {
		secret_type = secret_lover
		is_known_by = root
				}
	
					}
				}
			}
		}

gui_show_intimate_relations = {
saved_scopes = {
character
}
	is_valid = {
	root.age >= 6
	
	exists = scope:character
	exists = root
	scope:character ?= {
	OR = {
	this ?= root
	prestige_level >= 4
			highest_held_title_tier >= tier_empire
		AND = { in_diplomatic_range = root
			OR = {prestige_level >= 3
			highest_held_title_tier >= tier_kingdom}}
			has_character_flag = has_been_spied
		has_character_flag = had_high_level_report
	obf_has_close_or_intimate_relation = yes
	obf_has_relation_that_would_talk_about_him = yes
	
	AND = {revelation_score >= 30
	OR = {obf_has_high_level_knowledge_flags = yes
	obf_has_near_intimate_or_close_relation	= yes}}
	
	
	AND = {has_character_flag = partially_spied_2
			revelation_score > 70
			root ?= {NOT = {has_trait = dull}}}
		any_relation = {
		type = lover
		NOT = {has_secret_relation_lover = scope:character}
		is_alive = yes
		OR = {
		has_character_flag = has_been_spied
		has_character_flag = had_high_level_report
		has_character_flag = emissary_sent
	obf_has_high_level_knowledge_flags = yes
	has_character_flag = partially_spied_2}
		}
		any_secret = {
		secret_type = secret_lover
		is_known_by = root
				}
					}
				}
			}
		}			

gui_show_courtiers_tab = {
saved_scopes = {
character
}
	is_valid = {
	
	exists = scope:character
	exists = root
	scope:character ?= {
	OR = {
	this ?= root
	prestige_level >= 4
			highest_held_title_tier >= tier_empire
		AND = { in_diplomatic_range = root
			OR = {prestige_level >= 3
			highest_held_title_tier >= tier_kingdom}}
			has_character_flag = has_been_spied
			has_character_flag = had_low_level_report
	has_character_flag = had_medium_level_report
	has_character_flag = had_high_level_report
			has_character_flag = emissary_sent
	obf_has_high_level_knowledge_flags = yes
	obf_has_close_or_intimate_relation = yes
	obf_has_near_intimate_or_close_relation	= yes
	obf_has_relation_that_would_talk_about_him = yes
	has_character_flag = partially_spied_2
		any_courtier_or_guest = {
		is_alive = yes
		OR = {
		has_character_flag = has_been_spied
		has_character_flag = emissary_sent
	obf_has_high_level_knowledge_flags = yes
	has_character_flag = had_low_level_report
	has_character_flag = had_medium_level_report
	has_character_flag = had_high_level_report
	has_character_flag = partially_spied_2}
		}
	
					}
				}
			}
		}
	
gui_show_vassals_tab = {
saved_scopes = {
character
}
	is_valid = {
	
	exists = scope:character
	exists = root
	scope:character ?= {
	OR = {
	this ?= root
	prestige_level >= 4
			highest_held_title_tier >= tier_empire
		AND = { in_diplomatic_range = root
			OR = {prestige_level >= 3
			highest_held_title_tier >= tier_kingdom}}
			has_character_flag = has_been_spied
			has_character_flag = emissary_sent
	obf_has_high_level_knowledge_flags = yes
	obf_has_close_or_intimate_relation = yes
	obf_has_near_intimate_or_close_relation	= yes
	obf_has_relation_that_would_talk_about_him = yes
	has_character_flag = partially_spied_2
	has_character_flag = had_medium_level_report
	has_character_flag = had_high_level_report
		any_vassal = {
		is_alive = yes
		OR = {
		has_character_flag = has_been_spied
		has_character_flag = emissary_sent
	obf_has_high_level_knowledge_flags = yes
	has_character_flag = had_high_level_report
	has_character_flag = had_medium_level_report
	has_character_flag = partially_spied_2}
		}
	
					}
				}
			}
		}
	
	
	
#Show characters in list
		
gui_show_chars_in_list = { ###### ROOT IS CHARACTER IN LIST - PLAYER IS PLAYER
	saved_scopes = {
		player
	}
	is_valid = {
		OR = {
			scope:player ?= ROOT
			AND = {
			    # exists = root.liege
				root.liege ?= scope:player.liege
				OR = {
					is_councillor_of = scope:player.liege
					is_ruler = yes
				}
			}
			AND = {
				scope:player ?= {
					is_independent_ruler = no
					OR = {
						is_knight = yes
						is_councillor = yes
					}
				}
				OR = {	
					is_knight_of = scope:player.liege
					is_courtier_of = scope:player.liege
					is_pool_guest_of = scope:player.liege
				}
			}
			this ?= scope:player.liege
			is_at_same_location = scope:player
			prestige_level >= 4
			AND = {
				in_diplomatic_range = root
				prestige_level >= 3
			}
			has_character_flag = had_high_level_report
			has_character_flag = had_medium_level_report
			has_character_flag = had_low_level_report
			has_character_flag = partially_spied_2
			has_character_flag = partially_spied
			has_character_flag = emissary_sent
			has_character_flag = has_been_spied
			obf_has_high_level_knowledge_flags = yes
		}
	}
}

#Show Allies in war declare window
		
gui_show_allies_declare_war = { ###### ROOT IS CHARACTER IN LIST - PLAYER IS PLAYER
saved_scopes = {
player
}
	
	is_valid = {
	OR = {
		AND = {
			exists = scope:player.liege
			exists = root.liege
			root.liege ?= scope:player.liege
				OR = {is_councillor_of = scope:player.liege
					is_ruler = yes}}
	this ?= scope:player
		influence_level >= 3
			prestige_level >= 4
			highest_held_title_tier >= tier_empire
		AND = { in_diplomatic_range = scope:player
			OR = {prestige_level >= 3
				influence_level >= 2
			highest_held_title_tier >= tier_kingdom}}
			has_character_flag = has_been_spied
			has_character_flag = had_high_level_report
	obf_has_high_level_knowledge_flags = yes
	this ?= scope:player.liege
	is_contact_of = scope:player.liege
	## is_vassal_of = scope:player.liege
	is_vassal_or_below_of = scope:player.liege
	is_tributary_of_suzerain_or_above = root ## added by ljl
	is_allied_to = scope:player
	### confederation ?= { any_confederation_member = { this ?= scope:player } } # added by ljl
	## obf_is_in_same_confederation_as_root = yes ## added by ljl ##ROOT IS CHARACTER IN LIST - PLAYER IS PLAYER
	obf_can_be_hired_as_mercenary = yes
        any_county = {
		holder = root
			is_neighbor_to_realm = scope:player
		}
		any_sub_realm_county = {
			is_neighbor_to_realm = scope:player	
		}
	any_consort = {
		is_physically_able_ai_adult = yes
		NOT = {has_relation_rival = scope:player}
			OR = {
			is_child_of = scope:player
			is_parent_of = scope:player
			is_sibling_of = scope:player
			has_relation_lover = scope:player
			has_relation_friend = scope:player}
			}
		any_child = {
	is_physically_able_ai_adult = yes
		NOT = {has_relation_rival = scope:player}
			OR = {
			is_consort_of = scope:player
			is_child_of = scope:player
			is_parent_of = scope:player
			is_sibling_of = scope:player
			has_relation_lover = scope:player
			has_relation_friend = scope:player}
			}
		any_parent = {
	is_physically_able_ai_adult = yes
		NOT = {has_relation_rival = scope:player}
			OR = {
			is_consort_of = scope:player
			is_child_of = scope:player
			is_parent_of = scope:player
			is_sibling_of = scope:player
			has_relation_lover = scope:player
			has_relation_friend = scope:player}
			}
		any_sibling = {
	is_physically_able_ai_adult = yes
		NOT = {has_relation_rival = scope:player}
			OR = {
			is_consort_of = scope:player
			is_child_of = scope:player
			is_parent_of = scope:player
			is_sibling_of = scope:player
			has_relation_lover = scope:player
			has_relation_friend = scope:player}
			}
			any_relation = {
				type = lover
				NOR = {has_relation_rival = scope:player
						has_secret_relation_lover = root}
				is_physically_able_ai_adult = yes
				OR = {
					is_consort_of = scope:player
					is_child_of = scope:player
					is_parent_of = scope:player
					is_sibling_of = scope:player
					has_relation_lover = scope:player
					has_relation_friend = scope:player}
			}
			any_relation = {
			type = friend
			NOR = {has_relation_rival = scope:player
						has_secret_relation_friend = root}
			is_physically_able_ai_adult = yes
				OR = {
				is_consort_of = scope:player
				is_child_of = scope:player
				is_parent_of = scope:player
				is_sibling_of = scope:player
				has_relation_lover = scope:player
				has_relation_friend = scope:player}
			}
			any_relation = {
			type = rival
			NOR = {has_relation_rival = scope:player
						has_secret_relation_rival = root}
			is_physically_able_ai_adult = yes
			OR = {
			is_consort_of = scope:player
			is_child_of = scope:player
			is_parent_of = scope:player
			is_sibling_of = scope:player
			has_relation_lover = scope:player
			has_relation_friend = scope:player}
			}
			
		AND = {
			OR = {
				has_character_flag = partially_spied_2
				has_character_flag = emissary_sent}
			OR = {
			influence_level >= 2
			obf_will_hardly_talk_char_info_trigger = no
			has_trait = arrogant}}
			
	any_ally = {
			OR = {
			AND = {liege = scope:player.liege
				OR = {is_councillor_of = scope:player.liege
					is_ruler = yes}}
	this ?= scope:player
	influence_level >= 3
			prestige_level >= 4
			highest_held_title_tier >= tier_empire
		AND = { in_diplomatic_range = scope:player
			OR = {prestige_level >= 3 
				influence_level >= 2
			highest_held_title_tier >= tier_kingdom}}
			has_character_flag = has_been_spied
			has_character_flag = had_high_level_report
	obf_has_high_level_knowledge_flags = yes
	this ?= scope:player.liege
	is_contact_of = scope:player.liege
	is_vassal_of = scope:player.liege
	is_vassal_or_below_of = scope:player.liege
	is_tributary_of_suzerain_or_above = root ## added by ljl
	is_allied_to = scope:player
	### confederation ?= { any_confederation_member = { this ?= scope:player } } # added by ljl
	## obf_is_in_same_confederation_as_root = yes ## added by ljl ##ROOT IS CHARACTER IN LIST - PLAYER IS PLAYER
         any_county = {
		holder = root
			is_neighbor_to_realm = scope:player
		}
		any_sub_realm_county = {
			is_neighbor_to_realm = scope:player	
		}
	any_consort = {
	is_physically_able_ai_adult = yes
		NOT = {has_relation_rival = scope:player}
			OR = {
			is_child_of = scope:player
			is_parent_of = scope:player
			is_sibling_of = scope:player
			has_relation_lover = scope:player
			has_relation_friend = scope:player}
			}
		any_child = {
	is_physically_able_ai_adult = yes
		NOT = {has_relation_rival = scope:player}
			OR = {
			is_consort_of = scope:player
			is_child_of = scope:player
			is_parent_of = scope:player
			is_sibling_of = scope:player
			has_relation_lover = scope:player
			has_relation_friend = scope:player}
			}
		any_parent = {
	is_physically_able_ai_adult = yes
		NOT = {has_relation_rival = scope:player}
			OR = {
			is_consort_of = scope:player
			is_child_of = scope:player
			is_parent_of = scope:player
			is_sibling_of = scope:player
			has_relation_lover = scope:player
			has_relation_friend = scope:player}
			}
		any_sibling = {
	is_physically_able_ai_adult = yes
		NOT = {has_relation_rival = scope:player}
			OR = {
			is_consort_of = scope:player
			is_child_of = scope:player
			is_parent_of = scope:player
			is_sibling_of = scope:player
			has_relation_lover = scope:player
			has_relation_friend = scope:player}
			}
			any_relation = {
				type = lover
				NOR = {has_relation_rival = scope:player
						has_secret_relation_lover = root}
				is_physically_able_ai_adult = yes		
				OR = {
					is_consort_of = scope:player
					is_child_of = scope:player
			is_parent_of = scope:player
			is_sibling_of = scope:player
					has_relation_lover = scope:player
					has_relation_friend = scope:player}
			}
			any_relation = {
			type = friend
			NOR = {has_relation_rival = scope:player
					has_secret_relation_friend = root}
				is_physically_able_ai_adult = yes
				OR = {
				is_consort_of = scope:player
				is_child_of = scope:player
			is_parent_of = scope:player
			is_sibling_of = scope:player
				has_relation_lover = scope:player
				has_relation_friend = scope:player}
			}
			any_relation = {
			type = rival
			NOR = {has_relation_rival = scope:player
					has_secret_relation_rival = root}
			is_physically_able_ai_adult = yes
			OR = {
			is_consort_of = scope:player
			is_child_of = scope:player
			is_parent_of = scope:player
			is_sibling_of = scope:player
			has_relation_lover = scope:player
			has_relation_friend = scope:player}
			}
			
		AND = {
			OR = {
				has_character_flag = partially_spied_2
				has_character_flag = emissary_sent}
			OR = {
			influence_level >= 2
			obf_will_hardly_talk_char_info_trigger = no
			has_trait = arrogant}}
					}
				}	
			}
		}
}



#####VALUES FOR SKILLS
#Skills are known

gui_skills_are_known = {
	saved_scopes = {
		character
	}
	is_valid = {
		gui_skills_are_known = yes
	}
}

gui_skills_are_roughly_known = {
	saved_scopes = {
		character
	}
	is_valid = {
		gui_skills_are_roughly_known = yes
	}
}
	
gui_skills_are_not_known = {
	saved_scopes = {
		character
	}
	is_valid = {
	gui_skills_are_not_known = yes
	}
}

gui_any_skill_for_humble = {
	saved_scopes = {
		character
	}
	is_valid = {
		gui_any_skill_for_humble = yes
	}
}
	
gui_skills_diplo_for_known = {
	saved_scopes = {
		character
	}
	is_valid = {
		gui_skills_diplo_for_known = yes
	}
}

gui_skills_diplo_for_illusory = {
	saved_scopes = {
		character
	}
	is_valid = {
		gui_skills_diplo_for_illusory = yes
	}
}

gui_skills_martial_for_known = {
	saved_scopes = {
		character
	}
	is_valid = {
		gui_skills_martial_for_known = yes
	}
}

gui_skills_martial_for_illusory = {
	saved_scopes = {
		character
	}
	is_valid = {
		gui_skills_martial_for_illusory = yes
	}
}

gui_skills_steward_for_known = {
	saved_scopes = {
		character
	}
	is_valid = {
		gui_skills_steward_for_known = yes
	}
}

gui_skills_steward_for_illusory = {
	saved_scopes = {
		character
	}
	is_valid = {
		gui_skills_steward_for_illusory = yes
	}
}

gui_skills_intrigue_for_known = {
	saved_scopes = {
		character
	}
	is_valid = {
		gui_skills_intrigue_for_known = yes
	}
}

gui_skills_intrigue_for_illusory = {
	saved_scopes = {
		character
	}
	is_valid = {
		gui_skills_intrigue_for_illusory = yes
	}
}

gui_skills_learning_for_known = {
	saved_scopes = {
		character
	}
	is_valid = {
		gui_skills_learning_for_known = yes
	}
}

gui_skills_learning_for_illusory = {
	saved_scopes = {
		character
	}
	is_valid = {
		gui_skills_learning_for_illusory = yes
	}
}

####PORTRAITS SCRIPTED GUI'

gui_portrait_shown = {
saved_scopes = {
character
}
	is_valid = {
	
	exists = scope:character
	exists = root
		OR = {
		any_consort = {
		this ?= scope:character
		even_if_dead = yes
		}
		any_child = {
		this ?= scope:character
		even_if_dead = yes
		}
		any_parent = {
		this ?= scope:character
		even_if_dead = yes
		}
		any_sibling = {
		this ?= scope:character
		even_if_dead = yes
		}
		any_relation = {
		type = friend
		this ?= scope:character
		even_if_dead = yes
		}
		any_relation = {
		type = lover
		this ?= scope:character
		even_if_dead = yes
		}
		any_relation = {
		type = rival
		this ?= scope:character
		even_if_dead = yes
		}
		any_relation = {
		type = grudge
		this ?= scope:character
		even_if_dead = yes
		}
		AND = {scope:character ?= {is_pool_character = yes}
				root ?= {OR = {is_travelling = yes
				has_character_flag = searching_for_physician
				has_variable = ep3_laamp_decision_1000_is_visiting}}}
		any_scheme = {
			OR = {		scheme_type = seduce
						scheme_type = courting
						scheme_type = befriend
						scheme_type = convert_to_witchcraft}
						scheme_target_character = scope:character
					}	
	scope:character ?= {
	OR = {
	this ?= root
	any_scheme = {
			OR = {		scheme_type = seduce
						scheme_type = courting
						scheme_type = befriend
						scheme_type = convert_to_witchcraft}
						scheme_target_character = root
					}
	is_at_same_location = root
	is_spouse_of_even_if_dead = root
	obf_is_fellow_vassal_or_liege_councillor = yes
	obf_has_high_level_knowledge_flags = yes
	obf_has_close_or_intimate_relation = yes
	obf_has_near_intimate_or_close_relation	= yes
	is_close_or_extended_family_of = root
	obf_has_important_court_position = yes
	obf_is_courtier_or_guest = yes
	is_courtier_of = root
	obf_has_guardian_or_ward_relation = yes
	is_imprisoned_by = root
	AND = {
    exists = root.liege
    this ?= root.liege
	}
	is_contact_of = root
	is_vassal_of = root
	is_tributary_of = root ## added by ljl
	obf_is_fellow_vassal_or_liege_councillor = yes
	obf_works_in_same_court	= yes
	obf_has_rival_or_negative_relation = yes
	has_character_flag = partially_spied
	has_character_flag = partially_spied_2

						}
					}
				}
			}

	}

gui_portrait_not_shown = { ### HERE, JUST IN CASE BUT NOT UPDATED. NEEDS CHANGES
saved_scopes = {
character
}
	is_valid = {
	
	exists = scope:character
	exists = root
	NOR = {
	any_consort = {
		this ?= scope:character
		even_if_dead = yes
		}
		any_child = {
		this ?= scope:character
		even_if_dead = yes
		}
		any_parent = {
		this ?= scope:character
		even_if_dead = yes
		}
		any_sibling = {
		this ?= scope:character
		even_if_dead = yes
		}
		any_relation = {
		type = friend
		this ?= scope:character
		even_if_dead = yes
		}
		any_relation = {
		type = lover
		this ?= scope:character
		even_if_dead = yes
		}
		any_relation = {
		type = rival
		this ?= scope:character
		even_if_dead = yes
		}
		any_relation = {
		type = grudge
		this ?= scope:character
		even_if_dead = yes
		}
		AND = {
			exists = scope:character.liege
			exists = root.liege
			root.liege ?= scope:character.liege
				OR = {is_councillor_of = root.liege
					scope:character ?= {is_ruler = yes}}}
	scope:character ?= {
	OR = {
	this ?= root
	is_at_same_location = root
	has_character_flag = has_been_spied
	has_character_flag = emissary_sent
	obf_has_high_level_knowledge_flags = yes
	has_character_flag = partially_spied
	has_character_flag = partially_spied_2
	
					}
				}
			}
		}
	}
	
###OPINION

gui_opinion_shown = {
saved_scopes = {
character
}
	is_valid = {
	
	exists = scope:character
	exists = root
	NOT = {has_game_rule = opinions_disabled}
	NOT = {scope:character ?= root}	
	scope:character ?= {
			is_alive = yes
			age >= 6
			is_incapable = no
	OR = {
	obf_is_fellow_vassal_or_liege_councillor = yes
	AND = {
		OR = {
			has_character_flag = had_high_level_report
			has_character_flag = has_been_spied}
			is_vassal_or_below_of = root
			is_tributary_of = root ## added by ljl
		}
	obf_has_high_level_knowledge_flags = yes
	obf_has_close_or_intimate_relation = yes
	obf_has_near_intimate_or_close_relation = yes
	AND = {OR = {has_character_flag = emissary_sent
				has_character_flag = partially_spied_2}
			revelation_score >= 65}
	
	
					}
				}

		}
	}

gui_portrait_status_icons_shown = {
saved_scopes = {
character
}
	is_valid = {
	
	exists = scope:character
	exists = root
	scope:character ?= {
	is_alive = yes
	OR = {
	is_at_same_location = root
	has_character_flag = has_been_spied
	has_character_flag = had_high_level_report
	obf_is_fellow_vassal_or_liege_councillor = yes
	obf_has_high_level_knowledge_flags = yes
	has_character_flag = partially_spied
	has_character_flag = partially_spied_2
	has_character_flag = had_medium_level_report
	
					}
				}
			}
		}

#####OTHER SCRIPTED GUIS

gui_illusory_warrior_known = { ###CHAR IS ROOT

	is_valid = {
	is_ai = yes
	has_character_flag = illusory_warrior
	has_character_flag = partially_spied_3
	revelation_score >= 30
	is_alive = yes
	
		}
	}


#####BASIC COUNTY STATS

#army
gui_county_or_holding_stats_shown = {
saved_scopes = {
character
}
	is_valid = {
	
	exists = scope:character
	exists = root
	OR = {
	root ?= {
	OR = {is_diarch_of_target = scope:character
	AND = {exists = scope:character.liege
	is_diarch_of_target = scope:character.liege}}}
			
			
			AND = {exists = scope:character.cp:councillor_marshal
		scope:character.cp:councillor_marshal = root}
		
		AND = {exists = scope:character.liege
					exists = root.liege
					exists = root.liege.cp:councillor_marshal
					scope:character.liege ?= {is_vassal_or_below_of = root.liege}
					root.liege.cp:councillor_marshal = root}
					
		AND = {		exists = scope:character.liege
					exists = root.liege
					exists = scope:character.liege.cp:councillor_marshal
					root.liege ?= scope:character.liege
					scope:character.liege.cp:councillor_marshal = root}		
					
		AND = {
				exists = scope:character.top_liege
				exists = scope:character.top_liege.cp:councillor_marshal
				exists = root.top_liege
				root.top_liege ?= scope:character.top_liege
					scope:character.top_liege.cp:councillor_marshal = root}
		
		AND = {exists = scope:character.cp:councillor_steward
		scope:character.cp:councillor_steward = root}
		
		AND = {exists = scope:character.liege
					exists = root.liege
					exists = root.liege.cp:councillor_steward 
					scope:character.liege ?= {is_vassal_or_below_of = root.liege}
					root.liege.cp:councillor_steward = root}
					
		AND = {		exists = scope:character.liege
					exists = root.liege
					exists = scope:character.liege.cp:councillor_steward
					root.liege ?= scope:character.liege
					scope:character.liege.cp:councillor_steward = root}		
					
		AND = {
				exists = scope:character.top_liege
				exists = scope:character.top_liege.cp:councillor_steward
				exists = root.top_liege
				root.top_liege ?= scope:character.top_liege
					scope:character.top_liege.cp:councillor_steward = root}	
		AND = {is_landless_adventurer = yes
				is_target_in_variable_list = {
					name = laamp_visited_settlements_list
					target = scope:character.location
				}}
	
	scope:character ?= {
	OR = {
	this ?= root
	has_character_flag = requested_military_info
	has_character_flag = has_been_spied
	has_character_flag = had_high_level_report
	is_vassal_or_below_of = root
	is_tributary_of_suzerain_or_above = root ## added by ljl
	is_allied_to = root
	### confederation ?= { any_confederation_member = { this ?= root } } # added by ljl
    ## obf_is_in_same_confederation_as_root = yes 	#added by ljl
					}
				}
			}
		}
	}

gui_opinion_breakdown_shown = {
saved_scopes = {
character
}
	is_valid = {
	root ?= {is_incapable = no	
			age >= 12}
	
	exists = scope:character
	exists = root
	NOT = {has_game_rule = opinion_breakdown_disabled}
	NOT = {scope:character ?= root}
	scope:character ?= {is_alive = yes}
	scope:character ?= {age >= 6}
	scope:character ?= {is_incapable = no}
	
	scope:character ?= {
	OR = {
	AND = {revelation_score >= 10
	OR = {
	obf_has_high_level_knowledge_flags = yes
	obf_is_fellow_vassal_or_liege_councillor = yes
	obf_has_close_or_intimate_relation = yes}}
	AND = {
	OR = {has_character_flag = had_high_level_report
	has_character_flag = has_been_spied}
	revelation_score >= 25
	is_vassal_or_below_of = root
	is_tributary_of_suzerain_or_above = root ## added by ljl
	}
	
	
					}
				}
			}
		}



# gui_show_traits_in_lists = { # CURRENTLY NOT USED
# saved_scopes = {
# character
# }
# 	is_valid = {
	
# 	exists = scope:character
# 	exists = root
# 	NOT = {scope:character ?= root}
# 	NOT = {has_game_rule = hide_traits}
# 	scope:character ?= {
# 	OR = {
# 	is_spouse_of_even_if_dead = root

# 			obf_is_fellow_vassal_or_liege_councillor = yes
# 			obf_has_high_level_knowledge_flags = yes
# 			obf_has_close_or_intimate_relation = yes
# 			obf_has_near_intimate_or_close_relation = yes
# 			obf_has_guardian_or_ward_relation = yes
# 			obf_has_important_court_position = yes
# 			obf_has_near_intimate_or_close_relation	= yes
# 			has_character_flag = has_been_spied
# 			has_character_flag = had_high_level_report
	
# 	AND = {OR = {has_character_flag = emissary_sent
# 	has_character_flag = had_medium_level_report
# 				has_character_flag = partially_spied_2}
# 			obf_will_openly_talk_char_info_trigger = yes}
				
# 				}
# 			}
# 	}
# }

gui_show_personality_traits = {
saved_scopes = {
character
}
	is_valid = {
		exists = scope:character
	exists = root
	root ?= {is_incapable = no	
			age >= 6}
	

	NOT = {scope:character ?= root}
	NOT = {has_game_rule = hide_traits}
	scope:character ?= {
	OR = {
	is_spouse_of_even_if_dead = root
	obf_has_close_or_intimate_relation = yes
	has_character_flag = has_been_spied
	has_character_flag = had_high_level_report
		
		AND = {revelation_score >= 37.5
		OR = {
			obf_is_fellow_vassal_or_liege_councillor = yes
			obf_has_high_level_knowledge_flags = yes
			obf_has_guardian_or_ward_relation = yes
			obf_has_important_court_position = yes
			obf_has_near_intimate_or_close_relation	= yes}}
			
	
	AND = {OR = {has_character_flag = emissary_sent
				has_character_flag = had_medium_level_report
				has_character_flag = partially_spied_2}
			revelation_score >= 75}
				
				}
			}
	}
}
gui_show_education_traits = {
saved_scopes = {
character
}
	is_valid = {
	exists = scope:character
	exists = root
	root ?= {is_incapable = no	
			age >= 6}
	NOT = {scope:character ?= root}
	NOT = {has_game_rule = hide_traits}
	scope:character ?= {
	OR = {
	AND = {
	 OR = {is_courtier_of = root
     is_pool_guest_of = root}
	 OR = {
	 has_trait = education_diplomacy_3
	has_trait = education_martial_3
	has_trait = education_stewardship_3
	has_trait = education_intrigue_3
	has_trait = education_learning_3
	has_trait = education_diplomacy_4
	has_trait = education_martial_4
	has_trait = education_stewardship_4
	has_trait = education_intrigue_4
	has_trait = education_learning_4
					
							}}
	has_character_flag = has_been_spied
	has_character_flag = had_high_level_report
	has_character_flag = had_medium_level_report
		
				
				}
			}
	}
}

gui_show_other_traits = {
saved_scopes = {
character
}
	is_valid = {
	exists = scope:character
	exists = root
	root ?= {is_incapable = no	
			age >= 6}
	NOT = {scope:character ?= root}
	scope:character ?= {
	OR = {
            AND = {exists = root.var:laamp_first_recruit_var this ?= root.var:laamp_first_recruit_var }
            AND = {exists = root.var:laamp_second_recruit_var this ?= root.var:laamp_second_recruit_var }
            AND = {exists = root.var:laamp_third_recruit_var this ?= root.var:laamp_third_recruit_var }
            AND = {exists = root.var:laamp_generic_jane_var this ?= root.var:laamp_generic_jane_var }
            AND = {exists = root.var:laamp_spouse_material_var this ?= root.var:laamp_spouse_material_var }
            AND = {exists = root.var:laamp_hooded_figure_var this ?= root.var:laamp_hooded_figure_var }
	is_spouse_of_even_if_dead = root
	AND = {scope:character ?= {is_pool_character = yes}
				root ?= {has_character_flag = searching_for_physician}}
			prestige_level >= 4
			highest_held_title_tier >= tier_empire
		AND = { in_diplomatic_range = root
			OR = {prestige_level >= 3
			highest_held_title_tier >= tier_kingdom}}
			obf_is_fellow_vassal_or_liege_councillor = yes
			obf_has_high_level_knowledge_flags = yes
			obf_has_close_or_intimate_relation = yes
			obf_has_guardian_or_ward_relation = yes
			obf_has_important_court_position = yes
			obf_has_near_intimate_or_close_relation	= yes
			has_character_flag = has_been_spied
			has_character_flag = emissary_sent
			has_character_flag = had_high_level_report
			has_character_flag = had_medium_level_report
				has_character_flag = partially_spied_2
				obf_can_be_hired_as_mercenary = yes
				
				}
			}
	}
}

gui_show_physical_traits = {
saved_scopes = {
character
}
	is_valid = {
	NOT = {has_trait = blind}
	
	exists = scope:character
	exists = root
	NOT = {scope:character ?= root}
	scope:character ?= {
	OR = {
	            this ?= root.var:laamp_first_recruit_var
                this ?= root.var:laamp_second_recruit_var
                this ?= root.var:laamp_third_recruit_var
                this ?= root.var:laamp_generic_jane_var
                this ?= root.var:laamp_spouse_material_var
                this ?= root.var:laamp_hooded_figure_var
	AND = {is_pool_character = yes
				root ?= {is_travelling = yes}}
	is_spouse_of_even_if_dead = root
			prestige_level >= 4
			highest_held_title_tier >= tier_empire
		AND = { in_diplomatic_range = root
			OR = {prestige_level >= 3
			highest_held_title_tier >= tier_kingdom}}
			is_at_same_location = root
			obf_is_fellow_vassal_or_liege_councillor = yes
			obf_has_high_level_knowledge_flags = yes
			obf_has_close_or_intimate_relation = yes
			obf_has_guardian_or_ward_relation = yes
			obf_has_important_court_position = yes
			obf_has_near_intimate_or_close_relation	= yes
			has_character_flag = has_been_spied
			has_character_flag = emissary_sent
				has_character_flag = partially_spied_2
				has_character_flag = partially_spied
				has_character_flag = had_high_level_report
				has_character_flag = had_low_level_report
				has_character_flag = had_medium_level_report
				
				}
			}
	}
}

gui_show_scheme_success_very_unlikely = {
saved_scopes = {
player
}
	is_valid = {
			scheme_success_chance <= 15
	}
}

gui_show_scheme_success_unlikely = {
saved_scopes = {
player
}
	is_valid = {
			scheme_success_chance <= 33
			scheme_success_chance > 15
	}
}

gui_show_scheme_success_maybe = {
saved_scopes = {
player
}
	is_valid = {
			scheme_success_chance <= 67
			scheme_success_chance > 33
	}
}

gui_show_scheme_success_likely = {
saved_scopes = {
player
}
	is_valid = {
			scheme_success_chance <= 84
			scheme_success_chance > 67
	}
}

gui_show_scheme_success_very_likely = {
saved_scopes = {
player
}
	is_valid = {
			scheme_success_chance > 84
	}
}

gui_allow_sort_known_char_list = {

	is_valid = {
	root ?= {is_incapable = no	
			age >= 6}
	}
}

gui_character_is_blind = {

	is_valid = {
	has_trait = blind
	}
}

gui_character_is_incapable_or_young = {

	is_valid = {
	OR = {
	is_incapable = yes
	age < 12
		}
	}
}

gui_show_factions_against = {
saved_scopes = {
player
}
	is_valid = {
						exists = yes
						OR = {
						has_variable = faction_discovered
						faction_can_press_demands = yes
						faction_is_at_war = yes
						any_faction_member = {this ?= scope:player}
						faction_target = {NOT = {this ?= scope:player}}
						AND = {faction_is_type = independence_faction
						faction_discontent >= 90}
						AND = {faction_is_type = nation_fracturing_faction
						faction_discontent >= 85}
						AND = {faction_is_type = liberty_faction
						faction_discontent >= 80}
						AND = {faction_is_type = claimant_faction
						faction_discontent >= 75}
						AND = {faction_is_type = populist_faction
						faction_discontent >= 60}
						AND = {faction_is_type = peasant_faction
						faction_discontent >= 50}
						}
	}
}

gui_show_faction_power_very_low = {

	is_valid = {
						exists = yes
						faction_power < 50
	}
}

gui_show_faction_power_low = {

	is_valid = {
						exists = yes
						faction_power >= 50
						faction_power < 80
	}
}

gui_show_faction_power_balanced = {

	is_valid = {
						exists = yes
						faction_power >= 80
						faction_power < 150
	}
}

gui_show_faction_power_high = {

	is_valid = {
						exists = yes
						faction_power >= 150
						faction_power < 300
	}
}

gui_show_faction_power_very_high = {

	is_valid = {
						exists = yes
						faction_power >= 300
	}
}


gui_show_ultimatum = {
saved_scopes = {
player
}
	is_valid = {
						exists = yes
						faction_target = {this ?= scope:player}
	}
}

gui_show_faction_discontent_low = {

	is_valid = {
			faction_discontent <= 20
	}
}

gui_show_faction_discontent_medium = {

	is_valid = {
			faction_discontent <= 60
			faction_discontent > 20
	}
}
gui_show_faction_discontent_high = {

	is_valid = {
			faction_discontent <= 85
			faction_discontent > 60
	}
}

gui_show_faction_discontent_risky = {

	is_valid = {
			faction_discontent > 85
	}
}

gui_show_factions_members = {
saved_scopes = {
player
}

	is_valid = {
	
		OR = {
				AND = {exists = joined_faction
				joined_faction = {
					OR = {NOT = {faction_target = scope:player}
					faction_is_at_war = yes}}}		
				has_variable = obf_is_a_faction_member
				is_leading_faction_type = populist_faction
				is_leading_faction_type = peasant_faction
				AND = {exists = joined_faction
				joined_faction = {
					OR = {faction_is_type = peasant_faction
					faction_is_type = populist_faction}}}	
						
		}
	}
}

gui_show_factions_members_interface_message = {
saved_scopes = {
character
}

	is_valid = {
				
	exists = scope:character
	exists = root
				scope:character ?= {
				NAND = {
				exists = joined_faction
						joined_faction = {
					faction_target = root}	
				NOT = {has_variable = obf_is_a_faction_member}}}
						
		}
}
